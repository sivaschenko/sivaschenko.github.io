<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Magento 2. Adding column to Sales Order grid</title>
    <link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com">
    <link rel="dns-prefetch" href="//cdn.mathjax.org">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="First of all, ensure you have your column in database table, and it is mapped to any field of sales_order table...">
    <meta name="robots" content="all">
    <meta name="author" content="Sergii Ivashchenko">
    
    <meta name="keywords" content="magento2">
    <link rel="canonical" href="http://www.sivaschenko.com/magento2/2016/03/05/magento2-add-column-to-sales-order-grid/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for sivaschenko" href="/feed.xml" />
    <link rel="stylesheet" href="/css/style.css?201612201606" type="text/css">
    
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.rawgit.com/IonicaBizau/github-calendar/gh-pages/dist/github-calendar.css"/>
    
    
    
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Magento 2. Adding column to Sales Order grid">
    <meta property="og:description" content="Written with ♥ for developers">
    <meta property="og:url" content="http://www.sivaschenko.com/magento2/2016/03/05/magento2-add-column-to-sales-order-grid/">
    <meta property="og:site_name" content="sivaschenko">
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@sergeivaschenko" />
    <meta name="twitter:title" content="Magento 2. Adding column to Sales Order grid" />
    <meta name="twitter:description" content="First of all, ensure you have your column in database table, and it is mapped to any field of sales_order table..." />
    <meta name="twitter:url" content="http://www.sivaschenko.com/magento2/2016/03/05/magento2-add-column-to-sales-order-grid/" />
    <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/icons/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/icons/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/icons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/icons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/icons/favicon-32x32.png" sizes="32x32">
    
        <script type="text/javascript">
           (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
           (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
           m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
           })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
           ga('create', 'UA-33180732-4', 'auto');
           ga('send', 'pageview');
        </script>
    
</head>

<body class="site">
  
	
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="http://www.sivaschenko.com" class="site-title">sivaschenko</a>
      <nav class="site-nav"><a href="http://www.sivaschenko.com">Posts</a><a href="/about/">About</a><a href="/projects/">Projects</a>
</nav>
      <div class="clearfix"></div><div class="social-icons">
  <div class="social-icons-left">
    <a class="fa fa-github" href="https://github.com/sivaschenko"></a>
    
    
    <a class="fa fa-twitter" href="https://twitter.com/sergeivaschenko"></a>
    
    
    
    
    
    
    <a class="fa fa-envelope" href="mailto:contact@sivaschenko.com"></a>
    <a class="fa fa-rss" href="/feed.xml"></a>
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>
</div>
  </div>
</header>

    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        

<div class="post-header mb2">
  <h1 class="page-title">Magento 2. Adding column to Sales Order grid</h1>
  <span class="post-meta">Mar 5, 2016</span><br>
  
  <span class="post-meta small">
  5 minute read
  </span>
</div>
<article class="post-content">
  <p>Sales order grid in Magento 2 can be accessed in admin panel under “Sales” -&gt; “Orders” menu.
By default only several main columns are visible in grid, but there are additional columns, that can be enabled from “Columns” dropdown on the top-right side.</p>

<p><img src="http://www.sivaschenko.com/images/magento2-sales-order-grid-columns.png" alt="Magento 2 Sales Order Grid Columns" /></p>

<p>However, if you are creating a module that provides additional useful information about orders, it is a good idea to add corresponding columns to sales order grid.</p>

<p>Basically, to add a column to sales order grid you have to perform 3 simple steps:</p>

<ul>
  <li>Add column to <strong>sales_order_grid</strong> database table</li>
  <li>Add DI configuration to populate the column in <strong>sales_order_grid</strong> table with your value</li>
  <li>Add UI component configuration to display the column in grid</li>
</ul>

<p>Let’s go through this implementation step by step.</p>

<h1 id="preconditions">Preconditions</h1>

<p>First of all, ensure you have your column in database table, and it is mapped to any field of <strong>sales_order</strong> table. For my example, let’s assume that there is <strong>affiliate</strong> table consisting of two columns: <strong>order_id</strong> and <strong>affiliate_information</strong>. This table is used to store some <a href="http://en.wikipedia.org/wiki/Affiliate_marketing">affiliate information</a> related to particular order. It would be nice to display this information in “Affiliate Information” column in sales order grid. Let’s do this!</p>

<h1 id="adding-column-to-salesordergrid-database-table">Adding column to sales_order_grid database table</h1>

<p>Columns are added to database tables using <strong>InstallSchema</strong> script. To be consistent, this script should be updated in the same module, where affiliate table was added.</p>

<p>The following code fragment will do the trick:</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code>$setup-&gt;getConnection()-&gt;addColumn(
    $setup-&gt;getTable('sales_order_grid'),
    'affiliate_information',
    [
        'type' =&gt; Table::TYPE_TEXT,
        'comment' =&gt; 'Affiliate Information'
    ]
);
</code></pre>
</div>

<p>Just add it to <code class="highlighter-rouge">app/code/&lt;your_namespace&gt;/&lt;your_module&gt;/Setup/InstallSchema.php</code> file and it will create a column named <strong>affiliate_information</strong>, of type text, with comment “Affiliate Information” to <strong>sales_order_grid</strong> during installation.</p>

<p>Don’t worry about implications of core table modification. <strong>sales_order_grid</strong> is index table and is used for order grid rendering speed up. It is designed to store all information required for sales order grid rendering, so custom columns are required to be added to this table.</p>

<p>To reflect changes in database magento reinstallation is required. Optionally, deleting module entry from setup_module table and running bin/magento setup:upgrade command will be also ok.</p>

<p>After this step, <strong>affiliate_information</strong> column is present in <strong>sales_order_grid</strong> table, but is remaining empty as it is not mapped to any data source.</p>

<h1 id="di-configuration-to-populate-the-column-is-salesordergrid-table">DI configuration to populate the column is sales_order_grid table.</h1>

<p>On this stage, it would be good to understand how <strong>sales_order_grid</strong> table is populated.</p>

<p>When order is placed (according to default configuration), data related to this order is selected from <strong>sales_order</strong> table joining several additional tables and inserted to <strong>sales_order_grid</strong>. This operation is initiated by <code class="highlighter-rouge">\Magento\Sales\Model\ResourceModel\Grid::refresh</code> function and the default select is declared in “&lt;Magento Sales module&gt;/etc/di.xml” file.</p>

<p>So to include our table in mentioned insert from select, we have to extend di configuration creating <code class="highlighter-rouge">app/code/&lt;Namespace&gt;/&lt;Module&gt;/etc/adminhtml/di.xml</code> file.</p>

<p>The following xml snippet should be added to di configuration inside config node.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;config</span> <span class="err">...</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"Magento\Sales\Model\ResourceModel\Order\Grid"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;arguments&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"joins"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"affiliate"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"table"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>affiliate<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"origin_column"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>entity_id<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"target_column"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>order_id<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"columns"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"affiliate_information"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>affiliate.affiliate_information<span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;/arguments&gt;</span>
    <span class="nt">&lt;/virtualType&gt;</span>
    ...
<span class="nt">&lt;/config&gt;</span>
</code></pre>
</div>

<p>This configuration is specifying that affiliate table will be joined to select from <strong>sales_order</strong> on <code class="highlighter-rouge">sales_order.entity_id = affiliate.order_id</code> and will populate <strong>sales_order_grid.affiliate_information</strong> column with corresponding value from <strong>affiliate.affiliate_information</strong>.</p>

<p>After this step, our affiliate_information column in <strong>sales_order_grid</strong> table is populated with value from affilate table each time order is placed. Still, column will exist only in database, and will not be visible in admin panel.</p>

<h1 id="configure-ui-grid-component-to-display-the-column">Configure UI grid component to display the column</h1>

<p>Finally, to reflect the column on admin panel grid, we have to extend <strong>sales_order_grid</strong> ui component by adding a ui configuration file in our module.</p>

<p>It is possible to extend ui configuration fo sales order grid introducing <code class="highlighter-rouge">app/code/&lt;Namespace&gt;/&lt;Module&gt;/view/adminhtml/ui_component/sales_order_grid.xml</code> file.
Basically it should have the same name and path in relation to module directory as main sales order grid ui component file: <code class="highlighter-rouge">app/code/Magento/Sales/view/adminhtml/ui_component/sales_order_grid.xml</code></p>

<p>Put the following xml snippet to the ui configuration file:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;listing</span> <span class="err">...</span><span class="nt">&gt;</span>
    <span class="nt">&lt;columns</span> <span class="na">name=</span><span class="s">"sales_order_columns"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"affiliate_information"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"data"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"config"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"filter"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>text<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"label"</span> <span class="na">xsi:type=</span><span class="s">"string"</span> <span class="na">translate=</span><span class="s">"true"</span><span class="nt">&gt;</span>Affiliate Information<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;/column&gt;</span>
    <span class="nt">&lt;/columns&gt;</span>
<span class="nt">&lt;/listing&gt;</span>
</code></pre>
</div>

<p>This will extend sales_order_columns and add a column based on <strong>affiliate_information</strong> filed, of type text, with translatable label “Affiliate Information”.</p>

<h1 id="ensuring-salesordergrid-is-populated-after-value-is-inserted-to-source-table">Ensuring sales_order_grid is populated after value is inserted to source table.</h1>

<p>There are two approaches to ensure that correct value is present in source table when <strong>sales_order_grid</strong> is populated:</p>

<ul>
  <li>Save value to source table before <strong>sales_order_grid</strong> refresh is triggered.</li>
  <li>Trigger <strong>sales_order_grid</strong> refresh after saving value.</li>
</ul>

<p>First approach is necessary if value should be saved to source table right on place order action. One of solutions will be to create observer on event that is dispatched when order is saved, but grid is still not refreshed. Such event is <code class="highlighter-rouge">sales_order_save_after</code>.</p>

<p>Second approach is applicable when source table is updated some time after order is placed, or asynchronously. Here you have to call <code class="highlighter-rouge">\Magento\Sales\Model\ResourceModel\Grid::refresh</code> method after value is saved to source table.</p>

<h1 id="populating-created-salesordergrid-column-for-existing-order">Populating created sales_order_grid column for existing order</h1>

<p>For upgrading existing data either install (for first release of your module) or upgrade script should be created.</p>

<p>Here is an example of upgrade script populating <code class="highlighter-rouge">sales_order_grid.affiliate_information</code> column from <code class="highlighter-rouge">affiliate.affiliate_information</code> for 1.0.1 version of module.</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code>namespace YourNamespace\YourModule\Setup;

use Magento\Framework\Setup\ModuleContextInterface;
use Magento\Framework\Setup\ModuleDataSetupInterface;
use Magento\Framework\Setup\UpgradeDataInterface;

class UpgradeData implements UpgradeDataInterface
{
    /**
     * {@inheritdoc}
     */
    public function upgrade(ModuleDataSetupInterface $setup, ModuleContextInterface $context)
    {
        $setup-&gt;startSetup();

        if (version_compare($context-&gt;getVersion(), '1.0.1', '<span class="err">&lt;</span>')) {
            $connection = $setup-&gt;getConnection();
            $grid = $setup-&gt;getTable('sales_order_grid');
            $affiliate = $setup-&gt;getTable('affiliate');

            $connection-&gt;query(
                $connection-&gt;updateFromSelect(
                    $connection-&gt;select()
                        -&gt;join(
                            $affiliate,
                            sprintf('%s.entity_id = %s.order_id', $grid, $affiliate),
                            'affiliate_information'
                        ),
                    $grid
                )
            );
        }

        $setup-&gt;endSetup();
    }
}
</code></pre>
</div>

<p>For this upgrade script to be executed, you have to increase module version in module.xml (from 1.0.0 to 1.0.1) and run <code class="highlighter-rouge">bin/magento setup:upgtade</code> command</p>

<h1 id="final-tips">Final Tips</h1>

<p>Be sure to refresh config cache after editing xml files.</p>

<p>Provided setting are basic, and there are much more parameters available for install script, di and ui configuration to customize content and appearance of added column, take time to observe existing install scripts, di and ui configuration files and try adding more parameters to your implementation.</p>

<p>Hope this tutorial was useful for you. Please feel free to provide any feedback in comments or contact me directly.</p>

</article>
<div class="share-page">
  Share this post!
  <div class="share-links">
    
    <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?text=Magento 2. Adding column to Sales Order grid&url=http://www.sivaschenko.com/magento2/2016/03/05/magento2-add-column-to-sales-order-grid/" rel="nofollow" target="_blank" title="Share on Twitter"></a>
    
    <a class="fa fa-linkedin" href="http://www.linkedin.com/shareArticle?url=http://www.sivaschenko.com/magento2/2016/03/05/magento2-add-column-to-sales-order-grid/&title=Magento 2. Adding column to Sales Order grid" rel="nofollow" target="_blank" title="Share on LinkedIn"></a>
    
    
    <a class="fa fa-reddit" href="http://reddit.com/submit?url=http://www.sivaschenko.com/magento2/2016/03/05/magento2-add-column-to-sales-order-grid/&title=Magento 2. Adding column to Sales Order grid" rel="nofollow" target="_blank" title="Share on Reddit"></a>
    <a class="fa fa-stumbleupon" href="http://www.stumbleupon.com/submit?url=http://www.sivaschenko.com/magento2/2016/03/05/magento2-add-column-to-sales-order-grid/&title=Magento 2. Adding column to Sales Order grid" rel="nofollow" target="_blank" title="Share on StumbleUpon"></a>
    
  </div>
</div>

<div class="post-footer">
  <p>Written with ♥ by Sergii Ivashchenko.</p>
  <p>Follow him on <a href="https://twitter.com/sergeivaschenko">Twitter</a>.</p>
</div>


  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname  = 'sivaschenko';
    var disqus_identifier = '/magento2/2016/03/05/magento2-add-column-to-sales-order-grid';
    var disqus_title      = "Magento 2. Adding column to Sales Order grid";

    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




      </div>
    </div>
  </div>
  <footer class="center"><div class="measure"><small>&copy; 2016 Sergii Ivashchenko</small></div>
</footer>


</body>
</html>
